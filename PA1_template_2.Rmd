---
title: "Reproducible Research: Peer Assessment 1"
output: html_document
 keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

### 3. Data Processing
```{r, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
setwd("C:/AtrayeeB/Data_Scientist_Course/R_Program")


##### 3.1. Load libraries

library(ggplot2)
library(plyr)

## Loading and preprocessing the data

if(!file.exists('activity.csv')){
    unzip('activity.zip')
}
activityData <- read.csv('activity.csv')
```

## Processing the data
```{r, warning=FALSE, message=FALSE}
activityData$day <-weekdays(as.Date(activityData$date))
activityData$DateTime <- as.POSIXct(activityData$date, format="%Y-%m-%d")
clean <- activityData[!is.na(activityData$steps),]
```
## Calculate total number of steps taken per day?
```{r, warning=FALSE, message=FALSE}
sumtable <- aggregate(activityData$steps ~ activityData$date, FUN=sum,)
colnames(sumtable) <- c("Date","Steps")

## Make a histogram of the total number of steps taken each day

hist(sumtable$Steps, breaks =5, xlab ="Steps",main ="Total Steps per Day")


## Calculate and report the mean and median total number of steps taken per day

as.integer(mean(sumtable$Steps))
as.integer(median(sumtable$Steps))

## What is the average daily activity pattern?

averageStepsPerTimeBlock <- aggregate(x=list(meanSteps=activityData$steps), by=list(interval=activityData$interval), FUN=mean, na.rm=TRUE)
```

### Make a time series plot
```{r, warning=FALSE, message=FALSE}
ggplot(data=averageStepsPerTimeBlock, aes(x=interval, y=meanSteps)) +
    geom_line() +
    xlab("5-minute interval") +
    ylab("average number of steps taken") 
```
### Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r, warning=FALSE, message=FALSE}
mostSteps <- which.max(averageStepsPerTimeBlock$meanSteps)
timeMostSteps <-  gsub("([0-9]{1,2})([0-9]{2})", "\\1:\\2", averageStepsPerTimeBlock[mostSteps,'interval'])

## Most Steps at: 8:35

## Imputing missing values

### Calculate and report the total number of missing values in the dataset

numMissingValues <- length(which(is.na(activityData$steps)))

## Number of missing values: 2304

### Devise a strategy for filling in all of the missing values in the dataset.

## My strategy for filling in NAs will be to substitute the missing steps with the average 5 minute interval based on the day of the week.

## Create the average number of steps per weekday and interval

avgtable <- ddply(clean, .(interval,day), summarize, Avg = mean(steps))

## Create dataset with all NAs for substitution

nadata <- activityData[is.na(activityData$steps), ]

## Merge NA data with average weekday interval for substitution

newdata <- merge(nadata, avgtable, by= c("interval", "day"))

### Create a new dataset that is equal to the original dataset but with the missing data filled in.

## Reorder the new substituded data in the same format as clean data set
newdata2<- newdata[,c(6,4,1,2,5)]
colnames(newdata2)<- c("steps", "date", "interval", "day", "DateTime")

##Merge the NA averages and non NA data together
mergeData <- rbind(clean, newdata2)
```
### Make a histogram of the total number of steps taken each day
```{r, warning=FALSE, message=FALSE}
##Create sum of steps per date to compare with step 1
sumTable2 <- aggregate(mergeData$steps ~ mergeData$date, FUN=sum, )
colnames(sumTable2)<- c("Date", "Steps")

## Mean of Steps with NA data taken care of
as.integer(mean(sumTable2$Steps))
##[1] 10821

## Median of Steps with NA data taken care of
as.integer(median(sumTable2$Steps))
##[1] 11015

## Creating the histogram of total steps per day, categorized by data set to show impact
hist(sumTable2$Steps, breaks=5, xlab="Steps", main = "Total Steps per Day with NAs Fixed", col="Black")
legend("topright", c("Imputed Data", "Non-NA Data"), fill=c("black", "grey") )

## Are there differences in activity patterns between weekdays and weekends?
###Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.

mergeData$DayCategory <- ifelse(mergeData$day %in% c("Saturday", "Sunday"), "Weekend", "Weekday")

### Make a panel plot containing a time series plot

library(lattice) 
## Warning message: package 'lattice' was built under R version 3.3.2

## Summarize data by interval and type of day
intervalTable2 <- ddply(mergeData, .(interval, DayCategory), summarize, Avg = mean(steps))

##Plot data in a panel plot
xyplot(Avg~interval|DayCategory, data=intervalTable2, type="l",  layout = c(1,2),
       main="Average Steps per Interval Based on Type of Day", 
       ylab="Average Number of Steps", xlab="Interval")
```